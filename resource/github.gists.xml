<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Irakli Gozalishvili</author>
    <documentationURL></documentationURL>
    <sampleQuery>
    use "http://gozala.github.com/taskhub/resource/github.gists.xml";
    select * from github.gists where user = "gozala" and description = "metadocs"
    </sampleQuery>
    <sampleQuery>
        use "http://gozala.github.com/taskhub/resource/github.gists.xml";
        INSERT INTO github.gists (
            user,
            token,
            name,
            content,
            isPrivate
        ) VALUES (
            "gozala",
            "{hash}",
            "test.md",
            "Attempt to create gist using [YQL](https://developer.yahoo.com/yql/).
            
        Table from Irakli Gozalishvili",
            1
        )
    </sampleQuery>
  </meta>
  <bindings>
    <select itemPath="json.gists" produces="JSON">
      <urls>
        <url>http://gist.github.com/api/v1/json/gists/{user}</url>
      </urls>
      <inputs>
        <key id="user" type="xs:string" paramType="path" required="true"/>
      </inputs>
    </select>
    <insert itemPath="" produces="JSON">
        <urls>
            <url>http://gist.github.com/gists/</url>
        </urls>
        <inputs>
            <key id="user" type="xs:string" paramType="variable" required="true"/>
            <key id="token" type="xs:string" paramType="variable" required="true"/>
            <key id="name" type="xs:string" paramType="variable" required="true"/>
            <key id="content" type="xs:string" paramType="variable" required="true"/>
            <key id="extension" type="xs:string" paramType="variable" required="false"/>
            <key id="isPrivate" type="xs:boolean" paramType="variable" required="false"/>
        </inputs>
        <execute><![CDATA[
            var data = (isPrivate) ? "action_button=private&" : "";
            data += "login=" + user + "&token=" + token + "&";
            data += "file_name[gistfile1]=" + encodeURIComponent(name) + "&"
                + "file_ext[gistfile1]=" + encodeURIComponent(extension) + "&"
                + "file_contents[gistfile1]=" + encodeURIComponent(content);
            var html = request
                .header("Content-type","application/x-www-form-urlencoded")
                .header("Accept", "text/javascript")
                .post(data)
                .response;
            response.object = { id: /gist: (\w*) /.exec(html)[1] };
        ]]></execute>
    </insert>
    <update itemPath="" produces="JSON">
        <urls>
            <url>https://gist.github.com/{id}</url>
        </urls>
        <inputs>
            <key id="user" type="xs:string" paramType="variable" required="true"/>
            <key id="token" type="xs:string" paramType="variable" required="true"/>
            <key id="name" type="xs:string" paramType="variable" required="true"/>
            <key id="id" type="xs:string" paramType="path" required="true"/>
            <key id="extension" type="xs:string" paramType="variable" required="false"/>
            <value id="content" type="xs:string" paramType="variable" required="true"/>
        </inputs>
        <execute><![CDATA[
            function encode(data) {
                var message = "";
                for (var key in data) {
                    message += "&" + key + "=" + encodeURIComponent(data[key]);
                }
                return message.substring(1);
            }
            var data = {
                login: user,
                token: token,
                _method: "put"
            }
            data["file_name[" + name + "]"] = name;
            data["file_ext[" + name + "]"] = extension || name.substr(name.lastIndexOf("."));
            data["file_contents[" + name + "]"] = content;
            var html = request
                .header("Content-type","application/x-www-form-urlencoded")
                .header("Accept", "text/javascript, text/json")
                .post(encode(data))
                .response;
            response.object = {
                html: html
            };
        ]]></execute>
    </update>
  </bindings>
</table>
